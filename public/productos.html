<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <title>Productos - Ferremas</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        </head>
    <body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
        <a class="navbar-brand" href="#">Ferremas</a>
        <div class="navbar-nav">
            <a class="nav-link text-white" href="index.html">Clientes</a>
            <a class="nav-link text-white" href="productos.html">Productos</a>
            <a class="nav-link text-white" href="ventas.html">Ventas</a>
        </div>
        </div>
    </nav>

    <div class="container py-4">
        <h1 class="text-center mb-4">Gestión de Productos</h1>

        <!-- Formulario -->
        <div class="card mb-4">
        <div class="card-body">
            <form id="productoForm" class="row g-3">
            <input type="hidden" id="cod_producto" />
            <div class="col-md-3">
                <input type="text" id="nombre_producto" class="form-control" placeholder="Nombre del producto" required />
            </div>
            <div class="col-md-2">
                <input type="number" id="stock" class="form-control" placeholder="Stock" required />
            </div>
            <div class="col-md-2">
                <input type="number" id="precio" class="form-control" step="0.01" placeholder="Precio" required />
            </div>
            <div class="col-md-3">
                <input type="text" id="descripcion" class="form-control" placeholder="Descripción" required />
            </div>
            <div class="col-md-2 d-grid gap-2">
                <button type="submit" class="btn btn-success">Guardar</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarEdicion()">Cancelar</button>
            </div>
            </form>
        </div>
        </div>

        <!-- Tabla -->
        <div class="card">
        <div class="card-body">
            <table class="table table-hover">
            <thead class="table-dark">
                <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Stock</th>
                <th>Precio</th>
                <th>Descripción</th>
                <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaProductos"></tbody>
            </table>
        </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        const API_URL = "http://localhost:5500/api/productos";

        async function cargarProductos() {
        try {
            const res = await fetch(API_URL);
            const productos = await res.json();
            const tbody = document.getElementById("tablaProductos");
            tbody.innerHTML = "";

            productos.forEach(p => {
            const fila = document.createElement("tr");
            fila.innerHTML = `
                <td>${p.cod_producto}</td>
                <td>${p.nombre_producto}</td>
                <td>${p.stock}</td>
                <td>${p.precio}</td>
                <td>${p.descripcion}</td>
                <td>
                <button class="btn btn-sm btn-primary me-2" onclick='editarProducto(${JSON.stringify(p)})'>Editar</button>
                <button class="btn btn-sm btn-danger" onclick='eliminarProducto(${p.cod_producto})'>Eliminar</button>
                </td>
            `;
            tbody.appendChild(fila);
            });
        } catch (err) {
            console.error("Error al cargar productos:", err);
        }
        }

        async function eliminarProducto(id) {
        if (confirm("¿Eliminar este producto?")) {
            await fetch(`${API_URL}/${id}`, { method: "DELETE" });
            cargarProductos();
        }
        }

        function editarProducto(p) {
        document.getElementById("cod_producto").value = p.cod_producto;
        document.getElementById("nombre_producto").value = p.nombre_producto;
        document.getElementById("stock").value = p.stock;
        document.getElementById("precio").value = p.precio;
        document.getElementById("descripcion").value = p.descripcion;
        }

        function cancelarEdicion() {
        document.getElementById("productoForm").reset();
        }

        document.getElementById("productoForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const cod_producto = document.getElementById("cod_producto").value;
        const datos = {
            nombre_producto: document.getElementById("nombre_producto").value,
            stock: document.getElementById("stock").value,
            precio: document.getElementById("precio").value,
            descripcion: document.getElementById("descripcion").value
        };

        if (cod_producto) {
            await fetch(`${API_URL}/${cod_producto}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datos)
            });
        } else {
            await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datos)
            });
        }

        document.getElementById("productoForm").reset();
        cargarProductos();
        });

        cargarProductos();
    </script>

    </body>
</html>