<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Clientes - Ferremas</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>

    <body class="bg-light">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Ferremas</a>
                <div class="navbar-nav">   
                    <a class="nav-link text-white" href="index.html">Clientes</a>
                    <a class="nav-link text-white" href="productos.html">Productos</a>
                    <a class="nav-link text-white" href="ventas.html">Ventas</a>
                </div>
            </div>
        </nav>
    <div class="container py-4">
        <h1 class="text-center mb-4">Gestión de Clientes</h1>

        <!-- Formulario -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="clienteForm" class="row g-3">
                    <input type="hidden" id="id_cliente">
                    <div class="col-md-5">
                        <input type="text" id="nombre" class="form-control" placeholder="Nombre" required>
                    </div>
                    <div class="col-md-5">
                        <input type="text" id="domicilio" class="form-control" placeholder="Domicilio" required>
                    </div>
                    <div class="col-md-2 d-grid gap-2">
                        <button type="submit" class="btn btn-success">Guardar</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelarEdicion()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla -->
        <div class="card">
            <div class="card-body">
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Domicilio</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="clientesTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        const API_URL = 'http://localhost:5500/api/clientes';

        document.getElementById('clienteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('id_cliente').value;
            const nombre = document.getElementById('nombre').value;
            const domicilio = document.getElementById('domicilio').value;
            const cliente = { nombre, domicilio };

            if (id) {
                await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cliente)
                });
            } else {
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cliente)
                });
            }

            document.getElementById('clienteForm').reset();
            cargarClientes();
        });

        async function cargarClientes() {
            const res = await fetch(API_URL);
            const data = await res.json();
            const tbody = document.getElementById('clientesTableBody');
            tbody.innerHTML = '';

            data.forEach(cliente => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cliente.id_cliente}</td>
                    <td>${cliente.nombre}</td>
                    <td>${cliente.domicilio}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-2" onclick="editarCliente(${cliente.id_cliente}, '${cliente.nombre}', '${cliente.domicilio}')">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarCliente(${cliente.id_cliente})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editarCliente(id, nombre, domicilio) {
            document.getElementById('id_cliente').value = id;
            document.getElementById('nombre').value = nombre;
            document.getElementById('domicilio').value = domicilio;
        }

        async function eliminarCliente(id) {
            if (confirm('¿Estás seguro de eliminar este cliente?')) {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                cargarClientes();
            }
        }

        function cancelarEdicion() {
            document.getElementById('clienteForm').reset();
        }

        cargarClientes();
    </script>
    </body>

</html>